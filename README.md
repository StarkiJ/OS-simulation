# OS-simulation

Operating system simulation

操作系统模拟实验:

1. 进程调度实验
2. 虚拟页式存储管理系统
3. 文件系统

## 实验一：进程调度实验

【实验目的】

1. 理解在单处理器环境下的进程调度及状态转换的基本原理和关键点。
2. 编程实现时间片轮转调度、短进程优先调度和多级反馈队列调度算法。
3. 分析并比较不同调度算法的效率和公平性。

【实验要求】

1. 模拟每一个进程，需要包含到达时间，运行时间，优先级等属性。
2. 每一种调度算法都需要实现一个模拟函数，对进程结束时间进行仿真模拟。多级反馈队列调度算法至少包含三个队列，每个队列的时间片大小不同。
3. 对给定的一组进程，当采用不同的调度算法时，需仿真模拟这组进程的状态转换过程。进程的状态至少有就绪、运行和阻塞三种状态。
4. 当这组进程调度执行完成时，根据仿真模拟的结果，计算平均周转时间/平均带权周转时间，平均等待时间、平均响应时间、利用率等性能指标及公平性指标。
5. 能够提供合适的测试数据集，对每一种算法进行测试，并分析其结果。

【涉及的基本原理】

进程调度是指操作系统中关于处理系统进程运行顺序和方式的机制。在设计进程调度程序时，需要了解以下基本原理：

1. 进程的概念：进程是程序的一次执行过程，是系统进行资源分配和调度的基本单位。它由程序代码和相关数据、堆栈、PCB(Process Control Block, 进程控制块)等部分组成。
2. 进程的状态：进程最基本的三种状态是：就绪状态（Ready）、执行状态（Running）、和等待状态（Waiting）。在进程的生命周期中，会反复在这几种状态之间转换。
3. 调度器：负责根据特定策略，决定哪个进程占有CPU。调度器分为长程调度器（作业调度器）、短程调度器（CPU调度器）、中程调度器。本模拟实验仅涉及短程调度。
4. 进程调度策略：调度策略主要有先来先服务（FCFS）、最短作业优先（SJF）、优先级调度、轮转法（RR）、多级反馈队列等。这些调度策略均有其特定的场合和使用环境。
5. 多级反馈队列调度算法是一种兼顾了高响应比优先、短作业优先和时间片轮转等算法优点的算法。它将就绪队列分为若干个队列，每个队列的优先级不同；同时，各队列可以采用不同的调度算法，以达到最大程度地提高系统的吞吐量、响应时间以及带宽等性能指标。
6. 上下文切换：当CPU从一个进程切换到另一个进程时，需要保存当前进程的状态，并加载新的进程状态，这个过程被称为上下文切换，它会产生一定的开销。
7. 并发性：操作系统可以让多个进程“同时”运行，实际上是通过迅速地在不同进程间进行切换，为每个进程分配一段时间来执行，从而实现宏观上的并发。

【实验提示】

1. 在模拟实验中，进程的到达时间、运行时间以及进程的特性（CPU繁忙型、I/O繁忙型）通常是通过人工指定或使用随机数生成方法产生的。人工指定的方法更适用于测试环境，因为你可以控制所有的变量，使测试结果可预测并被理解。随机数生成的方法更能够创建更真实的运行环境，但在使用随机数生成方法确定进程到达时间和运行时间时，需要注意一些细节。例如，进程到达时间必须是递增的；运行时间应确保在合理范围内，不能太长也不能为0。同时，如果用随机方法生成的测试数据，务必记住保存这批数据或者保存随机种子，以确保实验结果的可重复性。
2. 在编程过程中，需要注意进程控制块PCB结构的选择，以便适应于不同算法的需求。
3. 在分析调度效果时，需要理解在不同的进程运行情况下（比如到达时间，服务时间，进程的数量等），不同的调度算法可能会有完全不同的表现。在进行平均周转时间等性能指标的计算时，也需要注意公平性的考量。
4. 在设计进程和调度算法时，要考虑清楚测试用例是否可以覆盖多种可能的情况，以便于发现并处理边缘情况。有时甚至要创建一些额外的测试用例去覆盖边缘情况，比如所有进程几乎同时到达，或者所有进程运行时间都一样等。

【验收标准】

1. 基本功能的实现：能够正确模拟时间片轮转调度、短进程优先调度和多级反馈队列调度算法，并且模拟的结果正确。
2. 选择合理的进程数据集进行展示：测试数据集能够为每种调度算法提供足够的测试覆盖。
3. 能够选择合适的性能评估指标和公平性指标来分析和评价各种调度算法。
4. 系统的稳定性和错误处理：程序在运行过程中是否能稳定执行，是否能有效地处理错误的情况。
5. 用户友好度：输出信息要能够清晰反映调度过程中进程的状态变化。
6. 代码质量：高质量的代码表现在清晰的组织结构，良好的命名规范，适当的注释等。良好的代码质量可以提高代码的可读性和可维护性。
7. 实验报告：一个好的实验报告应该详细描述算法的设计与实现的关键点、充分展示测试情况，记录遇到的问题及解决方案等，并对不同的调度算法进行性能和公平性分析，并得出你的结论。

## 实验二：虚拟页式存储管理系统

【实验目的】

1. 理解虚拟内存和物理内存之间的关系及转化，在什么情况下会发生缺页中断。
2. 理解和掌握各种页面置换算法的工作原理，包括先进先出（FIFO）、最近最少使用（LRU）、时钟置换（CLOCK）和随机置换算法，并通过模拟实验观察它们的执行过程。
3. 通过比较不同页面置换算法下系统的性能，理解不同算法的优缺点以及在何种情况下更适用。
4. 学习如何评估系统性能。通过实验结果，理解如何通过缺页中断次数、平均访问时间等指标去评估系统性能，并能合理地解释实验结果。
5. 从实验中体验和理解内存访问的局部性原理，提高自己对操作系统虚拟内存管理的理解。

【实验要求】

1. 设计并实现一个模拟的简单虚拟页式存储管理系统。在该系统中，应能模拟以下功能：创建进程的页表，为进程页面分配内存块，实现逻辑地址向物理地址的转换。当发生缺页时，通过缺页中断处理调入页面，如果需要，可以进行页面置换。
2. 制定一套模拟数据，包括要访问的页面、需执行的操作等，并按照虚拟页式存储管理的原则进行处理，展示每一步的执行结果。
3. 能够模拟出页面置换的情况，例如FIFO、LRU、CLOCK和随机置换等算法，比较并分析每种算法下系统的性能。

【涉及的基本原理】

1. 虚拟内存技术：这是一种使得计算机系统看上去具有比实际RAM更大的内存的技巧。它使用了硬盘空间作为对RAM的扩充并将之作为应用程序的虚拟存储器。
2. 页（Page）：操作系统管理内存的一个单位。操作系统会把逻辑地址空间分割为一系列连续的、固定大小的区域，这些区域就称为页。
3. 帧（Frame）：操作系统管理对应实际内存的一个单位，与页的大小一致。
4. 页表：虚拟页面和物理内存帧之间的映射存放在页表中。为了提高地址转换的效率，操作系统通常会采取一些策略来优化页表，如多级页表、倒置页表、TLB（Translation Lookaside Buffer）等。
5. 地址映射：操作系统会维护一个页表，记录页号和帧号的映射关系。当CPU发出一个虚拟地址时，操作系统会通过页表将虚拟地址转换为实际的物理地址。
6. 页面置换：由于内存有限，当分配给一个进程的所有页面都在使用中且需要加载新的页面时，操作系统必须选择一个页面将其移出内存以空出空间给新的页面，这个决定过程就是页面置换。常见的页面置换算法包括最近最久未使用（LRU）、最佳置换算法（OPT）、先进先出（FIFO）、时钟置换（CLOCK）等。
7. 缺页中断：当程序引用的页不在内存中时，会产生缺页中断，操作系统需要从磁盘中将页调入内存，并更新页表。

【实验提示】

1. 设计进程类，包含该进程的页表，页表中应包含页号和对应的物理块号等。
2. 设计内存类，模拟内存中的物理块，能够根据进程请求分配和回收物理块。
3. 设计地址转换函数，输入逻辑地址，输出物理地址。
4. 实现页面置换算法，对内存中的页面进行动态调整。
5. 缺页中断通常是因为进程尝试访问其虚拟内存空间中一个不存在于物理内存（RAM）中的页面时触发的，如果分配给该进程的物理内存已满，则需要进行页面置换。
6. 为了展示该内存管理系统，需设计合理的模拟数据，当运行内存管理程序时，展示每一步的内存分配、地址转换和页面置换情况。
7. 在模拟不同页面置换算法时，请选择合适的测试用例来体现内存访问的局部性原理，比如循环和递归时会访问重复的页面集，而访问数组或其它大型数据结构时会访问一大块连续的内存页面，这些情况在测试时需要考虑。
8. 分析并比较不同页面置换算法下系统的性能，需要定义一些性能指标，比如缺页中断次数、平均访问时间等。

【验收标准】

1. 基本功能的实现：能正确执行虚拟地址向物理地址的转换，正确实现了四种页面置换算法，包括LRU（最近最久未使用）、FIFO（先入先出）、CLOCK（时钟算法）和随机置换算法，能够在内存空间不足时，正确选择被替换的页面。
2. 选择合理的测试数据进行展示：能够设计合理的模拟数据，展示虚拟内存管理过程，能够通过模拟数据触发缺页置换过程，而不是直接指定并执行页面置换程序。
3. 系统的稳定性和错误处理：程序在运行过程中是否能稳定执行，是否能有效地处理错误的情况（如页面错误、地址越界错误）。
4. 用户友好度：系统应当对用户友好，易于使用。具体表现在接口设计的合理性，输出信息的清晰性等。
5. 代码质量：高质量的代码表现在清晰的组织结构，良好的命名规范，适当的注释等。良好的代码质量可以提高代码的可读性和可维护性。
6. 实验报告：一个好的实验报告应该详细描述系统的设计、实现的功能及使用方法，测试情况，以及遇到的问题、解决方式等。在实验报告中需要包含采用不同页面置换算法时系统性能的分析比较，需要采用合理的性能指标。
